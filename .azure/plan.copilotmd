# Azure Deployment Plan for ai-call-agent Project

## **Goal**
Based on the project to provide a plan to deploy the project to Azure using AZD. Since the IaC option is not specified, we will use bicep as the IaC option based on the target app services.

## **Project Information**
**ai-call-agent**  
- **Stack**: Python 3.12 (Standard Library)
- **Type**: Resilience and error recovery system for an AI Call Agent.
- **Containerization**: To be generated.
- **Dependencies**: No external Python packages detected; depends on external mocked services (ElevenLabs, LLM providers).
- **Hosting**: Azure Container Apps

## **Azure Resources Architecture**
```mermaid
graph TD
%% Services
svcazurecontainerapps_aicallagent["`Name: ai-call-agent
Path: /
Language: python`"]
subgraph "Compute Resources"
%% Resources
subgraph containerappenv["Azure Container Apps (ACA) Environment"]
azurecontainerapps_aicallagent("`ai-call-agent (Azure Container App)`")
end
containerappenv:::cluster
end
%% Relationships
svcazurecontainerapps_aicallagent --> |"hosted on"| azurecontainerapps_aicallagent
```

## **Recommended Azure Resources**
Application ai-call-agent:
- Hosting Service Type: Azure Container Apps
- SKU: Consumption plan (Optimal for varied loads)
- Configuration:
    - language: python
    - Environment Variables: []
    - dockerFilePath: ./Dockerfile
    - dockerContext: .

## **Recommended Supporting Services**:
- Application Insights
- User-Assigned Managed Identity
- Log Analytics Workspace
- Container Registry

## **Recommended Security Configurations**:
- User-Assigned Managed Identity must have permissions into the Key Vault (if added).
- User-Assigned Managed Identity must be assigned to all supported resources.
- AcrPull role assignment: User managed identity must have **AcrPull** role assigned to the container registry.

## **Execution Step**
Execution Steps:
1. âœ… [x] Containerization:
    - If Dockerfiles exist, list their paths. (None found)
    - Generate Dockerfile using `appmod-plan-generate-dockerfile`.
2. ðŸ”² Create Azure Infrastructure Files for AZD:
    - Provisioning tool: AZD. Files: `azure.yaml`, `infra/main.bicep`, `infra/main.parameters.json`.
    - Check available region/SKUs using `appmod-get-available-region-sku`.
    - Generate IaC files using `appmod-get-iac-rules`.
3. ðŸ”² Env setup for azd:
    - Run `azd env new`.
    - Set environment variables and subscription.
4. ðŸ”² Deployment:
    - Run `azd provision`.
    - Run `azd up`.
    - Validate with `appmod-get-azd-app-logs`.
5. ðŸ”² Summarize Result:
    - Use `appmod-summarize-result`.

## **Progress Tracking**
- [ ] Containerization
- [ ] Create Azure Infrastructure Files
- [ ] Env setup for azd
- [ ] Deployment
- [ ] Summarize Result
